% Generated by roxygen2: do not edit by hand
% Please edit documentation in _main.Rmd.
\name{cv_grid_search}
\alias{cv_grid_search}
\title{Grid Search Cross-Validation for Kernel EM Model}
\usage{
cv_grid_search(
  y,
  K,
  hSigma = 10,
  dates = NULL,
  biomass = default_biomass(y),
  leave_out_every = 5,
  grid_size = 7,
  ncores = NULL,
  log_grid = TRUE,
  grid_length_half = TRUE
)
}
\arguments{
\item{y}{A list of length T, where each element is a matrix of observations at a given time point.}

\item{K}{Number of mixture components (clusters) in the model.}

\item{hSigma}{Bandwidth parameter for smoothing the \code{Sigma} (covariance) estimates.}

\item{dates}{A vector of date-time objects (e.g., of class \code{POSIXct}) of length T corresponding to the time points in \code{y}.
If \code{NULL}, the function uses the sequence of indices.}

\item{biomass}{A list of length T, where each element is a numeric vector of length \eqn{n_t} containing the biomass (or count)
for the observations at that time point. Defaults to \code{default_biomass(y)}.}

\item{leave_out_every}{The number of folds for cross-validation (default is 5). The \eqn{\ell}-th fold is defined as the set of
time points \eqn{\{\ell, \ell + \text{leave_out_every}, \ell + 2 \times \text{leave_out_every}, \dots\}}.}

\item{grid_size}{Number of grid points for each bandwidth parameter, resulting in a x grid. Defaults to 7}

\item{ncores}{Number of cores to use for parallel processing. If \code{NULL} or less than 2, the grid search is performed sequentially.}

\item{log_grid}{Logical flag indicating whether the grid for the bandwidth parameters should be logarithmically spaced (if \code{TRUE})
or linearly spaced (if \code{FALSE}). Defaults to \code{TRUE}.}

\item{grid_length_half}{Logical flag indicating whether to use half the total time length (or median time) for computing the end of the grid.}
}
\value{
A list containing:
\describe{
\item{results}{A data frame (converted from a matrix) of cross-validation scores, with row names corresponding to evaluated \code{hmu} values
and column names to evaluated \code{hpi} values.}
\item{best_hmu}{The best \code{hmu} value (bandwidth for smoothing \code{mu}) according to the highest CV score.}
\item{best_hpi}{The best \code{hpi} value (bandwidth for smoothing \code{pi}) according to the highest CV score.}
\item{max_cv_score}{The highest cross-validation score observed.}
\item{hmu_vals}{The vector of \code{hmu} values that were evaluated.}
\item{hpi_vals}{The vector of \code{hpi} values that were evaluated.}
\item{time_elapsed}{The total time elapsed (in seconds) during the grid search.}
}
}
\description{
This function performs a grid search over bandwidth parameters for the kernel-based EM model via cross-validation.
The grid search is performed over the \code{hmu} (for the mean parameter) and \code{hpi} (for the mixing proportions)
while keeping \code{hSigma} fixed. Cross-validation is implemented by partitioning the data into folds by leaving out every
\code{leave_out_every}-th time point. For each parameter combination, the model is fit on the training data and evaluated
on the left-out data using the log-likelihood. The best parameters are selected as those that maximize the cross-validation score.
}
\details{
The function first determines whether the dates should be scaled based on whether \code{dates} is provided.
A grid of bandwidth values is then constructed (either logarithmically or linearly spaced) from the calculated range.
Cross-validation is performed for each parameter combination via the \code{kernel_em_cv} function. The grid search can be run
either sequentially or in parallel, depending on the value of \code{ncores}.
}